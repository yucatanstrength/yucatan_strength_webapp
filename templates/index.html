
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Yucatán Strength</title>
  <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@500;700&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #000;
      color: #f6d393;
      font-family: 'League Spartan', sans-serif;
      margin: 0;
      padding: 2rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .tile {
      background: #111;
      border: 1px solid #f6d393;
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.25rem 0;
      width: 100%;
      max-width: 480px;
    }
    select {
      width: 100%;
      padding: 0.6rem;
      margin-top: 0.5rem;
      border-radius: 6px;
      border: 1px solid #f6d393;
      background: #000;
      color: #f6d393;
      font-family: Arial, sans-serif;
      font-size: 1rem;
    }
    .result-box {
      margin-top: 1rem;
      padding: 1rem;
      background: #1a1a1a;
      border: 1px solid #f6d393;
      border-radius: 6px;
      font-family: 'Libre Baskerville', serif;
      color: white;
      text-align: center;
    }
    .footer {
      margin-top: 3rem;
      padding-bottom: 2rem;
      color: #f6d393;
      font-family: 'League Spartan', sans-serif;
      font-size: 0.9rem;
      text-align: center;
    }
    .footer a {
      color: #f6d393;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>Yucatán Strength Tools</h1>

  <div class="tile">
    <h2>TDEE Calculator</h2>
    <select id="gender"></select>
    <select id="age"></select>
    <select id="height"></select>
    <select id="weight"></select>
    <select id="activity"></select>
    <div class="result-box">
      TDEE: <span id="tdee-result">Awaiting input...</span>
    </div>
  </div>

  <div class="tile">
    <h2>Macro Calculator</h2>
    <select id="goal"></select>
    <div class="result-box">
      <div id="macro-calories">Calories: --</div>
      <div id="macro-protein">Protein: -- g</div>
      <div id="macro-fats">Fats: -- g</div>
      <div id="macro-carbs">Carbs: -- g</div>
    </div>
  </div>

  <div class="footer">
    In Lak’Ech Ala K’in<br>
    <a href="https://georgealuke.pythonanywhere.com" target="_blank">Apply for 1-on-1 Coaching</a>
  </div>

  <script>
    const gender = ["male", "female"];
    const activityLevels = [
      { val: "sedentary", label: "Sedentary" },
      { val: "light", label: "Light Activity" },
      { val: "moderate", label: "Moderate" },
      { val: "active", label: "Active" },
      { val: "very_active", label: "Very Active" }
    ];
    const goals = [
      { val: "cut", label: "Fat Loss" },
      { val: "maintain", label: "Maintain" },
      { val: "bulk", label: "Muscle Gain" }
    ];

    function populate(id, list) {
      const el = document.getElementById(id);
      el.innerHTML = "";
      list.forEach(v => {
        const o = document.createElement("option");
        if (typeof v === "string") {
          o.value = v; o.text = v[0].toUpperCase() + v.slice(1);
        } else {
          o.value = v.val; o.text = v.label;
        }
        el.appendChild(o);
      });
    }

    function populateRange(id, start, end, suffix = "") {
      const el = document.getElementById(id);
      el.innerHTML = "";
      for (let i = start; i <= end; i++) {
        const o = document.createElement("option");
        o.value = i;
        o.text = i + suffix;
        el.appendChild(o);
      }
    }

    async function calculateTDEE() {
      const data = {
        gender: document.getElementById("gender").value,
        age: parseInt(document.getElementById("age").value),
        height: parseFloat(document.getElementById("height").value),
        weight: parseFloat(document.getElementById("weight").value),
        activity: document.getElementById("activity").value
      };
      const res = await fetch("/tdee", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      const result = await res.json();
      document.getElementById("tdee-result").innerText = Math.round(result.tdee) + " kcal/day";
      window.tdeeGlobal = result.tdee;
      calculateMacros();
    }

    async function calculateMacros() {
      const res = await fetch("/macros", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          tdee: window.tdeeGlobal || 2500,
          goal: document.getElementById("goal").value,
          preference: "balanced"
        })
      });
      const data = await res.json();
      document.getElementById("macro-calories").innerText = "Calories: " + data.calories;
      document.getElementById("macro-protein").innerText = "Protein: " + data.protein + " g";
      document.getElementById("macro-fats").innerText = "Fats: " + data.fats + " g";
      document.getElementById("macro-carbs").innerText = "Carbs: " + data.carbs + " g";
    }

    window.onload = () => {
      populate("gender", gender);
      populate("activity", activityLevels);
      populate("goal", goals);
      populateRange("age", 13, 80, " yrs");
      populateRange("height", 140, 210, " cm");
      populateRange("weight", 40, 200, " kg");

      document.querySelectorAll("select").forEach(s =>
        s.addEventListener("change", () => calculateTDEE())
      );
    };
  </script>
</body>
</html>
